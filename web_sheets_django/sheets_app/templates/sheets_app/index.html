{% load static %}

<head>
<link rel="stylesheet" media="screen" href="{% static 'handsontable.full.css' %}">
<script type="text/javascript" src="{% static 'handsontable.full.js' %}"></script>
<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
</head>

<body>
<h1>Sheets</h1>

<div id="tablediv"></div>

<script>

//var data = [["", "Ford", "Volvo", "Toyota", "Honda"],["2016", 10, 11, 12, 13],["2017", 20, 11, 14, 13],["2018", 30, 15, 12, 13]];

var data = {% autoescape off %}{{ cells }}{% endautoescape %};

var data_ref = data;

var container = document.getElementById('tablediv');

var hooks = Handsontable.hooks.getRegistered();

console.log(hooks);

var hot = new Handsontable(container, {
	data: data_ref,
	rowHeaders: true,
	colHeaders: true
});

/*
hooks.forEach(function(h){
	hot.addHook(h,function(){
		console.log(h);
	});
});
*/

hot.addHook('beforeBeginEditing', function() {
	console.log('beforeBeginEditing');
});

hot.addHook('afterBeginEditing', function() {
	console.log(arguments);
	r = arguments[0];
	c = arguments[1];
	d = data_ref[r][c];
	console.log(d);
	data_ref[r][c] = 'hello';
	hot.render();
});

hot.addHook('afterChange', function() {
	arguments[0].forEach(function(args){
		console.log(args);

		$.ajax({
			url: '/sheets/set_cell',
			data: {
				'r': args[0],
				'c': args[1],
				's': args[3]
			},
			dataType: 'json',
			success: function (data_new) {
				console.log(data_new.cells);
				
				data_ref.splice(0,data_ref.length);

				data_new.cells.forEach(function(c){
					data_ref.push(c);
				});

				hot.render();
			}
		});

	});
});


</script>
</body>

